import datetime as dt

import pandas as pd
import streamlit as st
import yfinance as yf

st.set_page_config(page_title='Dashboard de Finanças',layout='wide')

st.title('Dashboard de Ações e Ativos')


end_date = dt.datetime.today()
start_date = dt.datetime(end_date.year-1,end_date.month,end_date.day)


with st.container():
    st.header('Pesquise de acordo com as opções abaixo:')

    col1, col2, col3 = st.columns(3)
    with col1:
        ativo = st.selectbox(label='Selecione o Ativo',placeholder='Escolha uma opção',options=['A2MC34.SA','A2VL34.SA','AALR3.SA','AALR3F.SA','AAPL34.SA','AAPL34F.SA','ABTT34.SA','AERI3.SA','AERI3F.SA','AESB3.SA','AESB3F.SA','AFHI11.SA','AFLT3.SA','AGRO3.SA','AGRO3F.SA','AGRX11.SA','AGXY3.SA','ALLD3.SA','ALPA3F.SA','ALPA4F.SA','ALPK3.SA','ALSO3.SA','ALUG11.SA','ALUP11.SA','ALUP11F.SA','ALUP3.SA','ALUP3F.SA','ALUP4.SA','ALUP4F.SA','AMAR3.SA','AMAR3F.SA','AMBP3.SA','AMZO34F.SA','ANIM3F.SA','APER3.SA','APER3F.SA','ARML3.SA','ARMT34.SA','ARZZ3F.SA','ASAI3.SA','ATEA3.SA','ATMP3.SA','ATTB34.SA','ATTB34F.SA','AURE3.SA','AVLL3.SA','AVON34.SA','AVON34F.SA','AXPB34.SA','B2YN34.SA','BALM3.SA','BALM3F.SA','BALM4.SA','BALM4F.SA','BBAS11.SA','BBAS12.SA','BBAS3.SA','BBAS3F.SA','BBDC3.SA','BBDC4.SA','BBDC4F.SA','BBGO11.SA','BBRK3.SA','BBRK3F.SA','BBSE3.SA','BCIR39.SA','BCWV39.SA','BDLL3F.SA','BDLL4F.SA','BEEF11.SA','BEEF3.SA','BEEF3F.SA','BERU39.SA','BFBI39.SA','BFCG39.SA','BFDA39.SA','BFDL39.SA','BFDN39.SA','BFPI39.SA','BFPX39.SA','BFTA39.SA','BFXH39.SA','BGOV39.SA','BHIA3.SA','BICL39.SA','BIDI11.SA','BIDI3.SA','BIDI4.SA','BIEI39.SA','BIME11.SA','BIOM3.SA','BIOM3F.SA','BIVE39.SA','BIVW39.SA','BIXG39.SA','BIYE39.SA','BIYT39.SA','BKYY39.SA','BLAU3.SA','BMGB11.SA','BMGB4.SA','BMIN3.SA','BMLC11.SA','BMOB3.SA','BMYB34.SA','BOAC34.SA','BOAC34F.SA','BOAS3.SA','BOEF39.SA','BPAN4.SA','BPAR3.SA','BPAR3F.SA','BQQW39.SA','BQTC39.SA','BRAP3.SA','BRAP3F.SA','BRAP4.SA','BRAP4F.SA','BRBI11.SA','BRFS3.SA','BRIT3.SA','BRKM3.SA','BRKM5.SA','BRKM5F.SA','BRKM6.SA','BRML3.SA','BRPR3.SA','BRPR3F.SA','BRSR3.SA','BRSR3F.SA','BRSR5.SA','BRSR5F.SA','BRSR6.SA','BRSR6F.SA','BSCZ39.SA','BSHV39.SA','BSHY39.SA','BSLI3.SA','BSLI3F.SA','BSLI4.SA','BSLI4F.SA','BSOX39.SA','BTLT39.SA','BTTL3.SA','BTTL3F.SA','BURT39.SA','BUSA39.SA','C2HD34.SA','C2OI34.SA','C2ON34.SA','C2PT34.SA','C2ZR34.SA','CACR11.SA','CAMB3F.SA','CAML3.SA','CAML3F.SA','CARD3.SA','CARD3F.SA','CASH3.SA','CASN3.SA','CASN3F.SA','CASN4.SA','CASN4F.SA','CBAV3.SA','CEAB3.SA','CEBR3.SA','CEBR3F.SA','CEBR5.SA','CEBR5F.SA','CEBR6.SA','CEBR6F.SA','CEDO3.SA','CEDO3F.SA','CEDO4.SA','CEDO4F.SA','CEED3.SA','CEED3F.SA','CEED4.SA','CEED4F.SA','CEGR3.SA','CEGR3F.SA','CEPE3.SA','CEPE3F.SA','CEPE5.SA','CEPE5F.SA','CEPE6.SA','CEPE6F.SA','CESP3.SA','CESP3F.SA','CESP5.SA','CESP6.SA','CGAS3.SA','CGAS3F.SA','CGAS5.SA','CGAS5F.SA','CGRA3.SA','CGRA3F.SA','CGRA4.SA','CGRA4F.SA','CHVX34.SA','CHVX34F.SA','CJCT11.SA','CLSA3.SA','CLSC3.SA','CLSC3F.SA','CLSC4.SA','CLSC4F.SA','CMCS34.SA','CMCS34F.SA','CMIG3.SA','CMIG3F.SA','CMIG4.SA','CMIN3.SA','COCA34.SA','COCA34F.SA','COCE3.SA','COCE3F.SA','COCE5.SA','COCE5F.SA','COCE6.SA','COCE6F.SA','COGN3.SA','COGN3F.SA','COLG34.SA','COLG34F.SA','CONX3.SA','COPH34.SA','COPH34.SA','CPFE3.SA','CPFE3F.SA','CPLE11.SA','CPLE11F.SA','CPLE3.SA','CPLE3F.SA','CPLE5.SA','CPLE5F.SA','CPLE6.SA','CPLE6F.SA','CPRE3.SA','CPRE3F.SA','CPTR11.SA','CRAA11.SA','CRFB3.SA','CRFB3F.SA','CRPG3.SA','CRPG5.SA','CRPG6.SA','CSCO34.SA','CSCO34F.SA','CSED3.SA','CSMO.SA','CSNA3.SA','CSNA3F.SA','CSUD3.SA','CTGP34.SA','CTGP34F.SA','CTKA3.SA','CTKA3F.SA','CTKA4.SA','CTKA4F.SA','CTNM3.SA','CTNM3F.SA','CTNM4.SA','CTNM4F.SA','CURY3.SA','CVCB3.SA','CXAG11.SA','CXSE3.SA','CYCR11.SA','CYRE3.SA','D2AS34.SA','D2KN34.SA','DESK3.SA','DEVA11.SA','DEXP3.SA','DEXP4.SA','DIRR3.SA','DIRR3F.SA','DMMO11.SA','DMMO3.SA','DMMO3F.SA','DMVF3.SA','DOTZ3.SA','DOTZ3F.SA','DXCO3.SA','EBAY34.SA','EBAY34F.SA','EEEL3.SA','EEEL3F.SA','EEEL4.SA','EEEL4F.SA','EGAF11.SA','EGIE3.SA','ELMD3.SA','ENAT3.SA','ENJU3.SA','ENMT3.SA','ENMT4.SA','EQIR11.SA','ESPA3.SA','ESTR3.SA','ESTR3F.SA','ESTR4.SA','ESTR4F.SA','EUCA3.SA','EUCA3F.SA','EUCA4.SA','EVEN3.SA','EVEN3F.SA','EXXO34.SA','EZTC3.SA','EZTC3F.SA','FCXO34.SA','FCXO34F.SA','FDMO34.SA','FDMO34F.SA','FESA3.SA','FESA3F.SA','FESA4.SA','FESA4F.SA','FGAA11.SA','FIQE3.SA','FLRY3.SA','FOOD11.SA','G2DD34.SA','G2DI33.SA','GBIO33.SA','GBIO33F.SA','GCRA11.SA','GEOO34.SA','GEOO34F.SA','GEPA3.SA','GEPA4.SA','GETT11.SA','GETT3.SA','GETT4.SA','GFSA3.SA','GFSA3F.SA','GGPS3.SA','GMAT3.SA','GOAU4.SA','GOGL35.SA','GOLL3.SA','GRAO3.SA','GRND3.SA','GRND3F.SA','GRWA11.SA','GSGI34.SA','GSGI34F.SA','GSHP3.SA','GSHP3F.SA','GTLG11.SA','HALI34.SA','HALI34F.SA','HBOR3.SA','HBOR3F.SA','HBSA3.SA','HCAR3.SA','HGAG11.SA','HOME34.SA','HOME34F.SA','HONB34.SA','HONB34F.SA','HOOT4.SA','HPQB34.SA','HPQB34F.SA','HSRE11.SA','HUSI11.SA','HYPE3.SA','IBMB34.SA','IBMB34F.SA','ICBR3.SA','IFCM3.SA','IGBR3.SA','IGBR3F.SA','IGTI11.SA','IGTI3.SA','INBR31.SA','INTB3.SA','IRBR3.SA','ITLC34.SA','ITLC34F.SA','ITSA3F.SA','ITSA4.SA','ITSA4F.SA','ITUB3.SA','ITUB3F.SA','ITUB4.SA','ITUB4F.SA','JALL3.SA','JBSS3.SA','JBSS3F.SA','JGPX11.SA','JHSF3.SA','JHSF3F.SA','JNJB34.SA','JPMC34.SA','JPMC34F.SA','JSAF11.SA','JSLG3.SA','K2CG34.SA','KLBN11.SA','KLBN11F.SA','KLBN3.SA','KLBN3F.SA','KLBN4.SA','KLBN4F.SA','KNCA11.SA','KRSA3.SA','LAND3.SA','LAVV3.SA','LCAM3.SA','LCAM3F.SA','LEVE3.SA','LEVE3F.SA','LINX3.SA','LINX3F.SA','LJQQ3.SA','LOGG3.SA','LPSB3.SA','LPSB3F.SA','LREN3.SA','LREN3F.SA','LSAG11.SA','LVTC3.SA','LWSA3.SA','M1TA34.SA','M2PW34.SA','MATD3.SA','MBLY3.SA','MCDC34.SA','MCDC34F.SA','MDIA3.SA','MDIA3F.SA','MDNE3.SA','MEGA3.SA','MELK3.SA','MERC4.SA','MFAI11.SA','MGLU3.SA','MGLU3F.SA','MILA.SA','MLAS3.SA','MMMC34F.SA','MMXM11.SA','MMXM3.SA','MNDL3.SA','MNDL3F.SA','MODL11.SA','MODL3.SA','MODL4.SA','MORC11.SA','MOVI3.SA','MOVI3F.SA','MRCK34.SA','MRCK34F.SA','MRFG3.SA','MRFG3F.SA','MRVE3.SA','MRVE3F.SA','MSBR34.SA','MSBR34F.SA','MSCD34.SA','MSCD34F.SA','MSFT34.SA','MSFT34F.SA','MTRE3.SA','MULT3.SA','MULT3F.SA','MYPK3.SA','MYPK3F.SA','N2ET34.SA','NCRA11.SA','NDIV11.SA','NEMO3.SA','NEMO5.SA','NEMO6.SA','NEOE3.SA','NFLX34.SA','NFLX34F.SA','NGRD3.SA','NIKE34.SA','NIKE34F.SA','NINJ3.SA','NTCO3.SA','NTCO3F.SA','NUBR33.SA','ODPV3.SA','ODPV3F.SA','OFSA3.SA','OIBR.SA','OIBR4.SA','OIBR4F.SA','ONCO3.SA','OPCT3.SA','ORCL34.SA','ORCL34F.SA','ORVR3.SA','OSXB3.SA','OSXB3F.SA','P2AT34.SA','P2EN34.SA','PARD3.SA','PASS3.SA','PCAR3.SA','PCAR3F.SA','PCAR4.SA','PCAR4F.SA','PDGR3.SA','PDGR3F.SA','PDTC3.SA','PEPB34.SA','PEPB34F.SA','PETR3.SA','PETR3F.SA','PETR4.SA','PETR4F.SA','PETZ3.SA','PFIZ34.SA','PFIZ34F.SA','PGCO34.SA','PGCO34F.SA','PGMN3.SA','PLCA11.SA','PLPL3.SA','PMAM3.SA','PMAM3F.SA','PNVL3.SA','PNVL3F.SA','PORT3.SA','POSI3.SA','POSI3F.SA','PPLA11.SA','PRIO3.SA','PRIO3F.SA','PRVA3.SA','PSSA3.SA','PSSA3F.SA','PURB11.SA','QCOM34.SA','QCOM34F.SA','QUAL3.SA','QUAL3F.SA','RADL3.SA','RADL3F.SA','RAIZ4.SA','RANI3F.SA','RBIV11.SA','RDNI3.SA','RDNI3F.SA','RECR11.SA','RECV3.SA','RENT3.SA','RENT3F.SA','RIOS3.SA','RIVA3.SA','RNEW11.SA','RNEW11F.SA','RNEW11F.SA','RNEW3.SA','RNEW4.SA','RNEW4F.SA','ROOF11.SA','RPMG3.SA','RPMG3F.SA','RRRP3.SA','RSID3.SA','RSID3F.SA','RURA11.SA','RZAG11.SA','RZAT11.SA','S2EA34.SA','S2HO34.SA','S2NW34.SA','S2QS34.SA','S2QU34.SA','S2TO34.SA','S2UI34.SA','SANB11.SA','SANB11F.SA','SANB3.SA','SANB3F.SA','SANB4.SA','SANB4F.SA','SAPR11.SA','SAPR11F.SA','SAPR3.SA','SAPR3F.SA','SAPR4.SA','SAPR4F.SA','SBFG3.SA','SBFG3F.SA','SBSP3.SA','SBSP3F.SA','SBUB34.SA','SBUB34F.SA','SCAR3.SA','SCAR3F.SA','SEER3.SA','SEQL3.SA','SIMH3F.SA','SLBG34.SA','SLBG34F.SA','SLED3.SA','SLED3F.SA','SLED4.SA','SLED4F.SA','SMAB11.SA','SMFT3.SA','SMLS3.SA','SMTO3.SA','SMTO3F.SA','SNAG11.SA','SOJA3.SA','SOMA3.SA','SPXB11.SA','STOC31.SA','SUZB3.SA','SUZB3F.SA','SYNE3.SA','T2DH34.SA','T2TD34.SA','TAEE11.SA','TAEE3.SA','TAEE4.SA','TCSA3.SA','TELB3.SA','TELB3F.SA','TELB4.SA','TELB4F.SA','TELD11.SA','TFCO4.SA','TIMS3.SA','TIMS3F.SA','TOTS3.SA','TOTS3F.SA','TRAD3.SA','TRPL3.SA','TRPL3F.SA','TRPL4.SA','TRPL4F.SA','TTEN3.SA','U2ST34.SA','UGPA3.SA','UGPA3F.SA','UNIP3.SA','UNIP5.SA','UNIP5F.SA','UNIP6.SA','UNIP6F.SA','URPR11.SA','USTK11.SA','VALE5.SA','VAMO3.SA','VBBR3.SA','VCRA11.SA','VERZ34.SA','VERZ34F.SA','VGIA11.SA','VIIA3.SA','VIIA3F.SA','VISA34.SA','VISA34F.SA','VITT3.SA','VIVA3.SA','VIVT3.SA','VIVT3F.SA','VSEC11.SA','VSTE3.SA','VSTE3F.SA','VVEO3.SA','W2ST34.SA','WALM34.SA','WALM34F.SA','WEST3.SA','WFCO34.SA','WFCO34F.SA','WHRL3.SA','WHRL4.SA','WRLD11.SA','XPBR31.SA','XRXB34.SA','XRXB34F.SA','YDRO11.SA','YDUQ3.SA','Z2NG34.SA','ZAMP3.SA',])
        
    with col2:
        data_inicial = st.date_input('Selecione a data inicial',start_date)

    with col3:
        data_final = st.date_input('Selecione a data final',end_date)





# Obtendo os dados usando o yfinance
df = yf.download(tickers=ativo, start=data_inicial, end=data_final)
df.index = df.index.date

# Metricas
ult_atualizacao = df.index.max() #data da última att
ult_cotacao = round(df.loc[df.index.max(),'Adj Close'],2) #ultima cotação encontrada
menor_cotacao = round(df['Adj Close'].min(),2) #menor cotacao encontrada
maior_cotacao = round(df['Adj Close'].max(),2) #maior cotacao encontrada
prim_cotacao = round(df.loc[df.index.min(),'Adj Close'],2) #primeira cotacao
delta = round(((ult_cotacao-prim_cotacao)/prim_cotacao)*100,2) #delta

with st.container():
    with col1:
        st.metric(f"Última Atualização - {ult_atualizacao}","{:,.2f}".format(ult_cotacao),f"{delta}%")

    with col2:
        st.metric("Menor Cotação do período","{:,.2f}".format(menor_cotacao))
            
    with col3:
        st.metric("Maior Cotação do período","{:,.2f}".format(maior_cotacao))


with st.container():
    st.line_chart(df[['Adj Close']],color=['#8A2BE2'])
